name: Direct Build

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup NDK
      run: |
        wget https://dl.google.com/android/repository/android-ndk-r25b-linux.zip
        unzip android-ndk-r25b-linux.zip
        export ANDROID_NDK=$(pwd)/android-ndk-r25b
        
    - name: Manual Build
      run: |
        # 直接使用 CMake 构建
        mkdir -p build_manual && cd build_manual
        cmake \
          -DCMAKE_BUILD_TYPE=Release \
          -DCMAKE_C_COMPILER="$ANDROID_NDK/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android23-clang" \
          -DCMAKE_CXX_COMPILER="$ANDROID_NDK/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android23-clang++" \
          ..
        make -j4
        
        # 检查结果
        file dfps
        ls -lh dfps
        
    - name: Upload binary
      uses: actions/upload-artifact@v4
      with:
        name: manual-build
        path: build_manual/dfps
